<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro:bit Runner Pro</title>
    <style>
        :root { --primary: #007bff; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); text-align: center; padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .step-display { font-size: 5rem; font-weight: 800; color: var(--primary); margin: 10px 0; transition: all 0.2s; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .box { background: #f1f3f5; padding: 15px; border-radius: 12px; }
        .val { font-size: 1.2rem; font-weight: bold; display: block; }
        .lbl { font-size: 0.8rem; color: #6c757d; text-transform: uppercase; }
        button { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        button:hover { opacity: 0.9; transform: scale(0.98); }
        #status { font-size: 0.8rem; margin-top: 15px; color: #adb5bd; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin-bottom: 5px;">üëü Dashboard</h2>
    <p style="color: #6c757d; margin-bottom: 25px;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡∏ö‡∏Å‡πâ‡∏≤‡∏ß Micro:bit</p>
    
    <button onclick="connectBluetooth()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Micro:bit</button>

    <div class="step-display" id="display-steps">0</div>
    <span class="lbl">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß‡∏™‡∏∞‡∏™‡∏°</span>

    <div class="grid">
        <div class="box">
            <span class="lbl">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)</span>
            <span class="val" id="display-dist">0.00</span>
        </div>
        <div class="box">
            <span class="lbl">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà (kcal)</span>
            <span class="val" id="display-cal">0.00</span>
        </div>
    </div>

    <div id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
</div>

<script>
    let uartChar;

    async function connectBluetooth() {
        const UART_SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
        const UART_TX_CHARACTERISTIC_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";

        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'BBC micro:bit' }],
                optionalServices: [UART_SERVICE_UUID]
            });

            document.getElementById('status').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService(UART_SERVICE_UUID);
            uartChar = await service.getCharacteristic(UART_TX_CHARACTERISTIC_UUID);

            await uartChar.startNotifications();
            uartChar.addEventListener('characteristicvaluechanged', handleIncomingData);
            
            document.getElementById('status').innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
            document.getElementById('status').style.color = "#28a745";
        } catch (error) {
            console.error(error);
            document.getElementById('status').innerText = "‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + error.message;
            document.getElementById('status').style.color = "#dc3545";
        }
    }

    function handleIncomingData(event) {
        // 1. ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Binary ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô String
        let decoder = new TextDecoder('utf-8');
        let rawData = decoder.decode(event.target.value);
        
        // 2. ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á/‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏© (\n)
        let cleanData = rawData.trim();
        
        // 3. ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
        let steps = parseInt(cleanData);

        if (!isNaN(steps)) {
            // 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
            let distance = (steps * 0.75) / 1000;
            let calories = steps * 0.04;

            // 5. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            const stepEl = document.getElementById('display-steps');
            stepEl.innerText = steps.toLocaleString();
            document.getElementById('display-dist').innerText = distance.toFixed(2);
            document.getElementById('display-cal').innerText = calories.toFixed(2);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Effect ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ä‡∏µ‡∏ß‡∏≤
            stepEl.style.transform = "scale(1.1)";
            setTimeout(() => { stepEl.style.transform = "scale(1)"; }, 100);
        }
    }
</script>

</body>
</html>
